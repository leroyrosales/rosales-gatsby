!function(e,t,s){function a(t,s){this.element=t,this.settings=e.extend({},o,s),this.defaults=o,this.name=l,this.mouseTimeoutID=null,this.focusTimeoutID=null,this.mouseFocused=!1,this.justFocused=!1,this.init()}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}function n(t,s){var a,n,l,o=t.nodeName.toLowerCase();return"area"===o?(a=t.parentNode,n=a.name,!(!t.href||!n||"map"!==a.nodeName.toLowerCase())&&(!!(l=e("img[usemap=#"+n+"]")[0])&&i(l))):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||s:s)&&i(t)}var l="accessibleMegaMenu",o={navToggle:"#nav-toggle",navId:"#primary-nav",mobileBreakpoint:"767",topNavIconClass:".icon",uuidPrefix:"accessible-megamenu",menuClass:"accessible-megamenu",topNavItemClass:"accessible-megamenu-top-nav-item",panelClass:"accessible-megamenu-panel",panelGroupClass:"accessible-megamenu-panel-group",hoverClass:"hover",focusClass:"focus",openClass:"open"},r={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38,keyMap:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",190:"."}};a.prototype=function(){var i,n,o,u,c,f,d,h,p,g,m,b,C,v,x=0,y=1e3,T="",D="function"==typeof t.hasOwnProperty&&!!t.hasOwnProperty("ontouchstart");return i=function(t){return e(t).closest(":data(plugin_"+l+")").data("plugin_"+l)},n=function(t){t=e(t);var s=this.settings;t.attr("id")||t.attr("id",s.uuidPrefix+"-"+(new Date).getTime()+"-"+ ++x)},o=function(t,a){var i,n=e(t.target),l=this,o=this.settings,u=this.menu,c=n.closest("."+o.topNavItemClass),f=n.hasClass(o.panelClass)?n:n.closest("."+o.panelClass);if(v.call(this,!0),a)if((c=u.find("."+o.topNavItemClass+" ."+o.openClass+":first").closest("."+o.topNavItemClass)).is(t.relatedTarget)||c.has(t.relatedTarget).length>0)0===c.length&&u.find("[aria-expanded=true]").attr("aria-expanded","false").removeClass(o.openClass).filter("."+o.panelClass).attr("aria-hidden","true");else{if(("mouseout"===t.type||"focusout"===t.type)&&c.has(s.activeElement).length>0)return void console.log("returned");c.find("[aria-expanded]").attr("aria-expanded","false").removeClass(o.openClass).filter("."+o.panelClass).attr("aria-hidden","true"),("keydown"===t.type&&t.keyCode===r.ESCAPE||"DOMAttrModified"===t.type)&&(i=c.find(":tabbable:first"),setTimeout(function(){u.find("[aria-expanded]."+l.settings.panelClass).off("DOMAttrModified.accessible-megamenu"),i.focus(),l.justFocused=!1},99))}else{clearTimeout(l.focusTimeoutID);var d=c.siblings();d.find("[aria-expanded]").attr("aria-expanded","false").removeClass(o.openClass).filter("."+o.panelClass).attr("aria-hidden","true"),d.find(o.topNavIconClass).removeClass("icon--open"),c.find("[aria-expanded]").attr("aria-expanded","true").addClass(o.openClass).filter("."+o.panelClass).attr("aria-hidden","false"),"mouseover"===t.type&&n.is(":tabbable")&&1===c.length&&0===f.length&&u.has(s.activeElement).length>0&&(console.log("focus set"),n.focus(),l.justFocused=!1),v.call(l)}},u=function(s){if(t.innerWidth>=this.settings.mobileBreakpoint){var a=e(s.currentTarget),i=a.closest("."+this.settings.topNavItemClass),n=a.closest("."+this.settings.panelClass);1===i.length&&0===n.length&&1===i.find("."+this.settings.panelClass).length&&(a.hasClass(this.settings.openClass)?this.justFocused?(s.preventDefault(),s.stopPropagation(),this.justFocused=!1):D&&(s.preventDefault(),s.stopPropagation(),o.call(this,s,a.hasClass(this.settings.openClass))):(s.preventDefault(),s.stopPropagation(),o.call(this,s),this.justFocused=!1))}},c=function(s){t.innerWidth>=this.settings.mobileBreakpoint&&0===e(s.target).closest(this.menu).length&&(s.preventDefault(),s.stopPropagation(),o.call(this,s,!0))},f=function(t){"aria-expanded"===t.originalEvent.attrName&&"false"===t.originalEvent.newValue&&e(t.target).hasClass(this.settings.openClass)&&(t.preventDefault(),t.stopPropagation(),o.call(this,t,!0))},d=function(t){clearTimeout(this.focusTimeoutID);var s=e(t.target),a=s.closest("."+this.settings.panelClass);s.addClass(this.settings.focusClass).on("click.accessible-megamenu",e.proxy(u,this)),this.justFocused=!this.mouseFocused,this.mouseFocused=!1,this.panels.not(a).filter("."+this.settings.openClass).length&&o.call(this,t)},h=function(s){this.justFocused=!1;var a=this,i=e(s.target),n=i.closest("."+this.settings.topNavItemClass);i.removeClass(this.settings.focusClass).off("click.accessible-megamenu"),t.cvox?a.focusTimeoutID=setTimeout(function(){t.cvox.Api.getCurrentNode(function(e){n.has(e).length?clearTimeout(a.focusTimeoutID):a.focusTimeoutID=setTimeout(function(e,t,a){o.call(e,s,a)},275,a,s,!0)})},25):a.focusTimeoutID=setTimeout(function(){o.call(a,s,!0)},300)},p=function(s){var n,l,c,f,d,h,p=this.constructor===a?this:i(this),g=p.settings,m=e(e(this).is("."+g.hoverClass+":tabbable")?this:s.target),b=p.menu,C=p.topnavitems,v=m.closest("."+g.topNavItemClass),x=b.find(":tabbable"),D=m.hasClass(g.panelClass)?m:m.closest("."+g.panelClass),I=D.find("."+g.panelGroupClass),k=m.closest("."+g.panelGroupClass),E=s.keyCode||s.which,N=!1,w=r.keyMap[s.keyCode]||"",P=1===v.length&&0===D.length;if(!m.is("input:focus, select:focus, textarea:focus, button:focus")){switch(m.is("."+g.hoverClass+":tabbable")&&e("html").off("keydown.accessible-megamenu"),E){case r.ESCAPE:o.call(p,s,!0);break;case r.DOWN:s.preventDefault(),P?(o.call(p,s),N=1===v.find("."+g.panelClass+" :tabbable:first").focus().length):N=1===x.filter(":gt("+x.index(m)+"):first").focus().length,!N&&t.opera&&"[object Opera]"===opera.toString()&&(s.ctrlKey||s.metaKey)&&(c=(x=e(":tabbable")).index(m),N=1===e(":tabbable:gt("+e(":tabbable").index(m)+"):first").focus().length);break;case r.UP:s.preventDefault(),P&&m.hasClass(g.openClass)?(o.call(p,s,!0),(n=C.filter(":lt("+C.index(v)+"):last")).children("."+g.panelClass).length&&(N=1===n.children().attr("aria-expanded","true").addClass(g.openClass).filter("."+g.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):P||(N=1===x.filter(":lt("+x.index(m)+"):last").focus().length),!N&&t.opera&&"[object Opera]"===opera.toString()&&(s.ctrlKey||s.metaKey)&&(c=(x=e(":tabbable")).index(m),N=1===e(":tabbable:lt("+e(":tabbable").index(m)+"):first").focus().length);break;case r.RIGHT:s.preventDefault(),P?N=1===C.filter(":gt("+C.index(v)+"):first").find(":tabbable:first").focus().length:(I.length&&k.length&&(N=1===I.filter(":gt("+I.index(k)+"):first").find(":tabbable:first").focus().length),N||(N=1===v.find(":tabbable:first").focus().length));break;case r.LEFT:s.preventDefault(),P?N=1===C.filter(":lt("+C.index(v)+"):last").find(":tabbable:first").focus().length:(I.length&&k.length&&(N=1===I.filter(":lt("+I.index(k)+"):last").find(":tabbable:first").focus().length),N||(N=1===v.find(":tabbable:first").focus().length));break;case r.TAB:c=x.index(m),s.shiftKey&&P&&m.hasClass(g.openClass)?(o.call(p,s,!0),(n=C.filter(":lt("+C.index(v)+"):last")).children("."+g.panelClass).length&&(N=n.children().attr("aria-expanded","true").addClass(g.openClass).filter("."+g.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):s.shiftKey&&c>0?N=1===x.filter(":lt("+c+"):last").focus().length:!s.shiftKey&&c<x.length-1?N=1===x.filter(":gt("+c+"):first").focus().length:t.opera&&"[object Opera]"===opera.toString()&&(c=(x=e(":tabbable")).index(m),N=s.shiftKey?1===e(":tabbable:lt("+e(":tabbable").index(m)+"):last").focus().length:1===e(":tabbable:gt("+e(":tabbable").index(m)+"):first").focus().length),N&&s.preventDefault();break;case r.SPACE:P&&(s.preventDefault(),u.call(p,s));break;case r.ENTER:break;default:if(clearTimeout(this.keydownTimeoutID),0===(T+=w!==T?w:"").length)return;for(this.keydownTimeoutID=setTimeout(function(){T=""},y),x=P&&!m.hasClass(g.openClass)?x.filter(":not(."+g.panelClass+" :tabbable)"):v.find(":tabbable"),s.shiftKey&&(x=e(x.get().reverse())),c=0;c<x.length;c++)if((f=x.eq(c)).is(m)){l=1===T.length?c+1:c;break}for(h=new RegExp("^"+T.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),"i"),c=l;c<x.length;c++)if(f=x.eq(c),d=e.trim(f.text()),h.test(d)){N=!0,f.focus();break}if(!N)for(c=0;c<l;c++)if(f=x.eq(c),d=e.trim(f.text()),h.test(d)){f.focus();break}}p.justFocused=!1}},g=function(t){(e(t.target).is(this.settings.panelClass)||e(t.target).closest(":focusable").length)&&(this.mouseFocused=!0),this.mouseTimeoutID=setTimeout(function(){clearTimeout(this.focusTimeoutID)},1)},m=function(s){t.innerWidth>=this.settings.mobileBreakpoint&&(clearTimeout(this.mouseTimeoutID),e(s.target).addClass(this.settings.hoverClass),o.call(this,s),e(s.target).is(":tabbable")&&e("html").on("keydown.accessible-megamenu",e.proxy(p,s.target)))},b=function(t){clearTimeout(this.mouseTimeoutID);var s=e(t.target);s.toggleClass("icon--open"),s.hasClass("icon--open")?o.call(this,t):o.call(this,t,!0),e(t.target).is(":tabbable")&&e("html").on("keydown.accessible-megamenu",e.proxy(p,t.target))},C=function(s){if(t.innerWidth>=this.settings.mobileBreakpoint){var a=this;e(s.target).removeClass(a.settings.hoverClass),a.mouseTimeoutID=setTimeout(function(){o.call(a,s,!0)},250),e(s.target).is(":tabbable")&&e("html").off("keydown.accessible-megamenu")}},v=function(t){var s=this.menu;t?(e("html").off("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu"),s.find("[aria-expanded]."+this.settings.panelClass).off("DOMAttrModified.accessible-megamenu")):(e("html").on("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu",e.proxy(c,this)),s.find("[aria-expanded=true]."+this.settings.panelClass).on("DOMAttrModified.accessible-megamenu",e.proxy(f,this)))},{constructor:a,init:function(){var t=this.settings,s=e(this.element),a=s.children().first(),i=a.children();this.start(t,s,a,i)},start:function(a,i,l,o){var r=this;this.settings=a,this.menu=l,this.topnavitems=o,i.attr("role","navigation"),l.addClass(a.menuClass),o.each(function(t,s){var i,l;(s=e(s)).addClass(a.topNavItemClass),i=s.find(":tabbable:first"),l=s.children(":not(:tabbable):last"),n.call(r,i),l.length&&(n.call(r,l),i.attr({"aria-haspopup":!0,"aria-controls":l.attr("id"),"aria-expanded":!1}),l.attr({role:"group","aria-expanded":!1,"aria-hidden":!0}).addClass(a.panelClass).not("[aria-labelledby]").attr("aria-labelledby",i.attr("id")))}),this.panels=l.find("."+a.panelClass),l.on("focusin.accessible-megamenu",":focusable, ."+a.panelClass,e.proxy(d,this)).on("focusout.accessible-megamenu",":focusable, ."+a.panelClass,e.proxy(h,this)).on("keydown.accessible-megamenu",e.proxy(p,this)).on("mouseover.accessible-megamenu",e.proxy(m,this)).on("mouseout.accessible-megamenu",e.proxy(C,this)).on("mousedown.accessible-megamenu",e.proxy(g,this)),e(a.topNavIconClass).on("mouseup.accessible-megamenu",e.proxy(b,this)),D&&l.on("touchstart.accessible-megamenu",e.proxy(u,this)),l.find("hr").attr("role","separator"),e(s.activeElement).closest(l).length&&e(s.activeElement).trigger("focusin.accessible-megamenu"),e(t).bind("resize",function(){e(t).width()>=a.mobileBreakpoint&&(e("."+a.topNavItemClass).find("[aria-expanded]").attr("aria-expanded","false").removeClass(a.openClass).filter("."+a.panelClass).attr("aria-hidden","true"),e("."+a.topNavItemClass).find(a.topNavIconClass).removeClass("icon--open")),e(a.navId).removeClass("active")}),e(a.navToggle).click(function(t){t.preventDefault(),e(a.navId).toggleClass("active"),e(a.navId).hasClass("active")?e(a.navToggle).html("CLOSE"):e(a.navToggle).html("MENU")})},getDefaults:function(){return this.defaults},getOption:function(e){return this.settings[e]},getAllOptions:function(){return this.settings},setOption:function(e,t,s){this.settings[e]=t,s&&this.init()}}}(),e.fn[l]=function(t){return this.each(function(){e.data(this,"plugin_"+l)||e.data(this,"plugin_"+l,new e.fn[l].AccessibleMegaMenu(this,t))})},e.fn[l].AccessibleMegaMenu=a,e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(s){return!!e.data(s,t)}}):function(t,s,a){return!!e.data(t,a[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var s=e.attr(t,"tabindex"),a=isNaN(s);return(a||s>=0)&&n(t,!a)}})}(jQuery,window,document);
